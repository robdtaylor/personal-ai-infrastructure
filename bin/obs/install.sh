#!/bin/bash
# Installation script for obs CLI
# Run: ./install.sh

set -e

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PAI_DIR="$(cd "${SCRIPT_DIR}/../.." && pwd)"
BIN_DIR="${HOME}/.local/bin"

echo "════════════════════════════════════════════════════════════════"
echo "  Installing obs CLI"
echo "════════════════════════════════════════════════════════════════"
echo ""
echo "  PAI Directory: ${PAI_DIR}"
echo "  Target: ${BIN_DIR}/obs"
echo ""

# Create bin directory if needed
mkdir -p "$BIN_DIR"

# Create wrapper script
cat > "${BIN_DIR}/obs" << EOF
#!/bin/bash
# obs CLI wrapper - auto-generated by install.sh
exec bun run "${PAI_DIR}/bin/obs/obs.ts" "\$@"
EOF

chmod +x "${BIN_DIR}/obs"

# Check if ~/.local/bin is in PATH
if [[ ":$PATH:" != *":$BIN_DIR:"* ]]; then
    echo "⚠️  ${BIN_DIR} is not in your PATH"
    echo ""
    echo "Add this to your shell profile (~/.zshrc or ~/.bashrc):"
    echo "  export PATH=\"\$HOME/.local/bin:\$PATH\""
    echo ""
fi

echo "✅ obs CLI installed successfully!"
echo ""
echo "════════════════════════════════════════════════════════════════"
echo "  NEXT STEPS"
echo "════════════════════════════════════════════════════════════════"
echo ""
echo "1. Verify installation:"
echo "   obs --help"
echo ""
echo "2. Try searching your vault:"
echo "   obs search \"keyword\""
echo "   obs search --tag project/pai"
echo ""
echo "3. Build semantic search index (optional):"
echo "   obs embed"
echo "   obs semantic \"machine learning\""
echo ""
echo "4. List tags:"
echo "   obs tags"
echo "   obs tags --counts"
echo ""
echo "════════════════════════════════════════════════════════════════"
echo ""
