#!/bin/bash
# Installation script for ingest CLI
# Run: ./install.sh

set -e

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PAI_DIR="$(cd "${SCRIPT_DIR}/../.." && pwd)"
BIN_DIR="${HOME}/.local/bin"

echo "════════════════════════════════════════════════════════════════"
echo "  Installing ingest CLI"
echo "════════════════════════════════════════════════════════════════"
echo ""
echo "  PAI Directory: ${PAI_DIR}"
echo "  Target: ${BIN_DIR}/ingest"
echo ""

# Create bin directory if needed
mkdir -p "$BIN_DIR"

# Create wrapper script
cat > "${BIN_DIR}/ingest" << EOF
#!/bin/bash
# ingest CLI wrapper - auto-generated by install.sh
exec bun run "${PAI_DIR}/bin/ingest/ingest.ts" "\$@"
EOF

chmod +x "${BIN_DIR}/ingest"

# Check if ~/.local/bin is in PATH
if [[ ":$PATH:" != *":$BIN_DIR:"* ]]; then
    echo "⚠️  ${BIN_DIR} is not in your PATH"
    echo ""
    echo "Add this to your shell profile (~/.zshrc or ~/.bashrc):"
    echo "  export PATH=\"\$HOME/.local/bin:\$PATH\""
    echo ""
fi

echo "✅ ingest CLI installed successfully!"
echo ""
echo "════════════════════════════════════════════════════════════════"
echo "  NEXT STEPS"
echo "════════════════════════════════════════════════════════════════"
echo ""
echo "1. Verify installation:"
echo "   ingest --help"
echo ""
echo "2. Configure Telegram:"
echo "   ingest setup"
echo ""
echo "3. Test your setup:"
echo "   ingest test"
echo "   ingest poll"
echo ""
echo "4. Try the new features:"
echo "   ingest watch              # Daemon mode"
echo "   echo \"test\" | ingest direct  # Direct capture"
echo ""
echo "════════════════════════════════════════════════════════════════"
echo ""
